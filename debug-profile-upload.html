<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Upload Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .debug-section {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .preview-image {
            max-width: 200px;
            max-height: 200px;
            border: 2px solid #007bff;
            border-radius: 8px;
            margin: 10px 0;
        }
        .file-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .upload-btn {
            background: #007bff;
            color: white;
        }
        .upload-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .clear-btn {
            background: #dc3545;
            color: white;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Profile Upload Debug Tool</h1>
    
    <div class="debug-section">
        <h3>File Selection Test</h3>
        <input type="file" id="fileInput" accept="image/*">
        <div id="fileInfo" class="file-info" style="display: none;"></div>
        <img id="previewImage" class="preview-image" style="display: none;">
        
        <div>
            <button id="uploadBtn" class="upload-btn" disabled>Upload Picture</button>
            <button id="clearBtn" class="clear-btn" onclick="clearSelection()">Clear Selection</button>
        </div>
    </div>
    
    <div class="debug-section">
        <h3>Debug Log</h3>
        <div id="debugLog" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        let selectedFile = null;
        let previewUrl = null;

        function log(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function clearSelection() {
            selectedFile = null;
            
            // Clean up preview URL
            if (previewUrl) {
                URL.revokeObjectURL(previewUrl);
                previewUrl = null;
            }
            
            // Reset UI
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('previewImage').style.display = 'none';
            document.getElementById('uploadBtn').disabled = true;
            
            log('File selection cleared');
        }

        function onFileSelected(event) {
            const fileList = event.target.files;
            log('File selection event triggered');
            
            if (fileList && fileList.length > 0) {
                const file = fileList[0];
                log(`File found: ${file.name}, Size: ${file.size}, Type: ${file.type}`);

                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file (JPG, PNG, GIF)');
                    clearSelection();
                    return;
                }

                // Validate file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    clearSelection();
                    return;
                }

                // Set the selected file
                selectedFile = file;
                
                // Generate preview URL
                if (previewUrl) {
                    URL.revokeObjectURL(previewUrl);
                }
                previewUrl = URL.createObjectURL(file);
                
                // Update UI
                const fileInfo = document.getElementById('fileInfo');
                fileInfo.innerHTML = `
                    <strong>Selected File:</strong><br>
                    Name: ${file.name}<br>
                    Size: ${formatFileSize(file.size)}<br>
                    Type: ${file.type}
                `;
                fileInfo.style.display = 'block';
                
                const previewImage = document.getElementById('previewImage');
                previewImage.src = previewUrl;
                previewImage.style.display = 'block';
                
                document.getElementById('uploadBtn').disabled = false;
                
                log(`File selected successfully: ${file.name}`);
                log(`Preview URL generated: ${previewUrl}`);
                log(`Upload button enabled: ${!document.getElementById('uploadBtn').disabled}`);
            } else {
                log('No file selected');
                clearSelection();
            }
        }

        function uploadFile() {
            if (!selectedFile) {
                alert('Please select a file first');
                return;
            }
            
            log('Upload button clicked - this would trigger the actual upload');
            alert('Upload functionality would be triggered here');
        }

        // Initialize
        document.getElementById('fileInput').addEventListener('change', onFileSelected);
        document.getElementById('uploadBtn').addEventListener('click', uploadFile);
        
        log('Debug tool initialized');
    </script>
</body>
</html>
